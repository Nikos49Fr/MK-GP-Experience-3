// /sass/classement.scss
// ----------------------------------------------------
// Classement Widget (250x800) — MK GP Experience 3
// ----------------------------------------------------
@use 'variables' as *; // import globales (couleurs, polices, etc.)
@use 'fonts';          // import des polices locales

// ----------------------
// Variables locales polices (famille + poids + taille)
// ----------------------
$font-rank: $font-f1;
$font-rank-weight: $font-weight-f1bold;
$font-rank-size: 14px;

$font-tag: $font-f1;
$font-tag-weight: 700;
$font-tag-size: 14px;

$font-points: $font-f1;
$font-points-weight: 400;
$font-points-size: 12px;
$font-points-color: #aaa;

// ----------------------
// Variables globales
// ----------------------
$opacity-rank: 0.95;
$opacity-state: 0.9;
$opacity-secondary: 0.85;
$opacity-header: 1;

$w-widget: 250px;
$h-widget: 800px;

$h-header: 60px;
$h-state: 26px;
$pad-state-y: 4px;

$border-state-color: rgba(255, 255, 255, 0.25);

$row-h: ($h-widget - $h-header - $h-state) / 24; // hauteur fixe d’une ligne

// ----------------------
// Variables couleurs de fond (tes valeurs de test)
// ----------------------
$bg-header: $bg-color; // header
$bg-state: #333;      // state
$bg-rank: $bg-color;   // rank
$bg-other: #222;       // team/tag/bonus/points

// ----------------------
// Helpers
// ----------------------
@mixin text-ellipsis {
    overflow: hidden;
    white-space: nowrap;
    text-overflow: ellipsis;
}

// ----------------------------------------------------
// Presets d’affichage (SCSS map) + classes modifieurs
// ----------------------------------------------------
$classement-presets: (
    'mk8-12': (rows: 12),
    'mkw-24': (rows: 24),
    'teams-6': (rows: 6),
    'teams-8': (rows: 8),
    'msg-prestart': (rows: 0),
    'msg-mk8-noscores': (rows: 0),
    'msg-mkw-noscores': (rows: 0)
);

@each $key, $conf in $classement-presets {
    .classement-widget--#{$key} {
        @if map-get($conf, rows) > 0 {
            .cw-list {
                // on N'IMPOSE PAS de template-rows ici
                // la hauteur vient du nb d’enfants + grid-auto-rows
                display: grid;
                grid-auto-rows: $row-h;
                padding: 0; margin: 0; gap: 0; border: 0; border-radius: 0; box-shadow: none;
            }
        // --- MODES MESSAGE (rows = 0) ---
        }
        @else {
            .cw-list {
                // conteneur centre + padding autorisé pour les messages
                display: flex;
                align-items: center;
                justify-content: center;

                // on garde le fond défini globalement (bg-other + $opacity-secondary)
                padding: 50px 12px; // padding autorisé UNIQUEMENT pour les presets message
                margin: 0;
                gap: 0;
                border: 0;
                border-radius: 0;
                box-shadow: none;

                .cw-message {
                    // largeur max pour aérer un peu le texte
                    max-width: 220px;
                    text-align: center;

                    // Vertical rhythm global
                    line-height: 2;

                    // Reset marges par défaut
                    h2, h3, p, span { margin: 0; padding: 0; }

                    // TITRE principal (Formula1)
                    h2 {
                        font-family: $font-f1;      // Formula1
                        font-weight: 700;           // gras fourni par @font-face
                        font-size: 24px;
                        letter-spacing: 0.5px;
                        text-transform: uppercase;
                        line-height: 1.1;

                        // petite respiration sous le titre
                        margin-bottom: 6px;
                    }

                    // Le premier <span> après h2 (le “3”) — style badge
                    // (fonctionne avec ton HTML actuel : <h2>...</h2><span>3</span>)
                    h2 + span {
                        display: inline-block;
                        font-family: $font-f1;
                        font-weight: 700;
                        font-size: 24px;
                        line-height: 1;
                        padding: 4px 10px;
                        border-radius: 999px;
                        background: rgba(255,255,255,0.12);
                        color: $text-color;
                        margin-bottom: 10px;
                    }

                    // Sous-titres (Formula1)
                    h3 {
                        font-family: $font-f1;      // Formula1
                        font-weight: 700;
                        font-size: 20px;
                        letter-spacing: 0.4px;
                        text-transform: uppercase;
                        margin-top: 10px;
                        margin-bottom: 4px;
                    }

                    // Lignes d’info (spans/p) — un poil plus grandes et lisibles
                    p, span {
                        display: block;
                        font-family: $font-points;   // tu peux switcher vers $font-f1 si tu préfères
                        font-weight: $font-points-weight;
                        font-size: 16px;            // un peu plus grand
                        letter-spacing: 0.2px;
                        opacity: 0.95;
                    }
                    p {
                        padding-top: 10px;
                        border-top: 1px solid #999;
                    }

                    // Micro-espacement entre les lignes
                    p + p, p + span, span + p, span + span {
                        margin-top: 3px;
                    }

                    // Un léger séparateur visuel entre blocs
                    h3 + span { margin-top: 4px; }
                }
            }
        }
    }
}


// ----------------------
// Racine du composant
// ----------------------
.classement-widget {
    box-sizing: border-box;
    width: $w-widget;
    height: auto; // ← au lieu de height: $h-widget
    background: transparent;
    color: $text-color;
    overflow: hidden;
    display: flex;
    flex-direction: column;

    padding: 0;
    margin: 0;
    gap: 0;
    border: none;
    box-shadow: none;

    border-top-left-radius: 16px;
    border-top-right-radius: 16px;

    margin-left: 100px; // pour test
}

// ----------------------
// Header (logo)
// ----------------------
.cw-header {
    box-sizing: border-box;
    height: $h-header;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba($bg-header, $opacity-header);

    img {
        display: block;
        max-height: 100%;
        max-width: 100%;
        height: auto;
    }
}

// ----------------------
// État de la course
// ----------------------
.race-state {
    box-sizing: border-box;
    height: $h-state;
    display: flex;
    align-items: center;
    justify-content: center;

    background: rgba($bg-state, $opacity-state);

    border-top: 1px solid $border-state-color;
    border-bottom: 1px solid $border-state-color;
    padding-top: $pad-state-y;
    padding-bottom: $pad-state-y;

    font-family: $font-tag;
    font-weight: $font-tag-weight;
    font-size: $font-tag-size;
    letter-spacing: 0.5px;
}

// ----------------------
// Liste du classement
// ----------------------
.cw-list {
    box-sizing: border-box;
    //height: calc(#{$h-widget} - #{$h-header} - #{$h-state}); // hauteur fixe désactivée
    display: grid;
    grid-auto-rows: $row-h; // ← chaque ligne a la même hauteur qu’en mode 24
    // grid-template-rows: repeat(24, 1fr);
    background: rgba($bg-other, $opacity-secondary);
}

// ----------------------
// Ligne de classement
// ----------------------
.cw-row {
    display: grid;
    grid-template-columns: 28px 34px 1fr 34px 60px; // rank | logo | tag | bonus | points
    align-items: stretch; // <-- étire TOUTES les colonnes à la hauteur complète du track
    height: 100%;
    min-height: 0;
    overflow: hidden;

    // Colonne Rank (fond propre)
    .col-rank {
        background: rgba($bg-rank, $opacity-rank);
        height: 100%;                 // <-- s'assure de prendre toute la hauteur
        display: flex;
        align-items: center;
        justify-content: center;

        font-family: $font-rank;
        font-weight: $font-rank-weight;
        font-size: $font-rank-size;
        line-height: 1;
        letter-spacing: 0.2px;
        padding: 0;
    }

    // Autres colonnes (fond = hérité du bloc .cw-list)
    .col-team,
    .col-tag,
    .col-bonus,
    .col-points {
        background: transparent;
        height: 100%;                 // <-- prend toute la hauteur pour aligner visuellement
        display: flex;
        align-items: center;
    }

    .col-team {
        justify-content: center;

        .team-logo {
            width: 24px;
            height: 24px;
            object-fit: contain;
            display: block;
        }
    }

    .col-tag {
        padding: 0 6px;
        font-family: $font-tag;
        font-weight: $font-tag-weight;
        font-size: $font-tag-size;
        letter-spacing: 0.6px;
        justify-content: flex-start;
        @include text-ellipsis;
    }

    .col-bonus {
        justify-content: center;
    }

    .col-points {
        padding: 0 6px;
        justify-content: flex-end;
        font-family: $font-points;
        font-weight: $font-points-weight;
        font-size: $font-points-size;
        color: $font-points-color;
        letter-spacing: 0.4px;
        @include text-ellipsis;
    }

    &.is-empty {
        .col-tag,
        .col-points,
        .col-bonus {
            opacity: 0.35;
        }

        .col-team .team-logo {
            opacity: 0.3;
            filter: grayscale(100%);
        }
    }
}
